<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resumen Boletín SSMAA #453 | ADN-Aguascalientes</title>
    <meta name="description" content="Resumen detallado del Boletín Ambiental de la SSMAA #453. Proyectos ingresados, resolutivos emitidos y mapas de ubicación.">
    
    <!-- OpenGraph -->
    <meta property="og:title" content="Resumen Boletín SSMAA #453 | ADN-Aguascalientes">
    <meta property="og:description" content="Resumen detallado del Boletín Ambiental de la SSMAA #453. Proyectos ingresados, resolutivos emitidos y mapas de ubicación.">
    <meta property="og:url" content="https://adn-a.org/boletines-ssmaa/resumen/453">
    <meta property="og:image" content="https://adn-a.org/assets/miniaturaboletines.png">
    <meta property="og:type" content="website">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Resumen Boletín SSMAA #453">
    <meta name="twitter:description" content="Resumen detallado del Boletín Ambiental de la SSMAA #453. Proyectos ingresados, resolutivos emitidos y mapas de ubicación.">
    <meta name="twitter:image" content="https://adn-a.org/assets/miniaturaboletines.png">
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Poppins', Arial, sans-serif; 
            background: #f5f5f5; 
            color: #1F2937;
            line-height: 1.6;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { 
            background: linear-gradient(135deg, #F97316 0%, #EA580C 100%);
            color: white; 
            padding: 2rem; 
            text-align: center; 
            border-radius: 8px 8px 0 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .header h1 { font-size: 1.75rem; font-weight: 700; margin-bottom: 0.5rem; }
        .header h2 { font-size: 1.25rem; font-weight: 400; }
        .content { background: white; padding: 2rem; border-radius: 0 0 8px 8px; }
        .section-title { 
            font-size: 1.5rem; 
            font-weight: 700; 
            color: #1F2937; 
            margin: 2rem 0 1rem 0;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #F3F4F6;
        }
        .fecha-limite { 
            background: #F9FAFB; 
            border-left: 4px solid #F97316; 
            padding: 0.75rem 1rem; 
            margin-bottom: 1.5rem;
            border-radius: 0 4px 4px 0;
        }
        .project-card { 
            background: white; 
            border: 1px solid #E5E7EB; 
            border-radius: 8px; 
            padding: 1.5rem; 
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .project-title { 
            font-size: 1.1rem; 
            font-weight: 700; 
            color: #1F2937; 
            margin-bottom: 1rem; 
        }
        .project-info { display: flex; gap: 2rem; }
        .project-details { flex: 1; }
        .info-item { margin-bottom: 0.75rem; }
        .info-label { font-weight: 600; color: #374151; font-size: 0.875rem; }
        .info-value { color: #6B7280; font-size: 0.875rem; margin-left: 0.5rem; }
        .naturaleza { 
            margin-top: 1rem; 
            padding: 1rem; 
            background: #F9FAFB; 
            border: 1px solid #E5E7EB; 
            border-radius: 4px; 
            font-size: 0.875rem; 
            line-height: 1.5; 
        }
        .map-container { width: 400px; height: 300px; flex-shrink: 0; }
        .map-image { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            border: 1px solid #E5E7EB; 
            border-radius: 4px; 
        }
        .map-info { margin-top: 0.5rem; text-align: center; font-size: 0.75rem; color: #6B7280; }
        .map-link { color: #F97316; text-decoration: none; }
        .map-link:hover { text-decoration: underline; }
        .footer { 
            background: #F9FAFB; 
            border-top: 1px solid #E5E7EB; 
            padding: 1.5rem 2rem; 
            margin-top: 2rem;
            border-radius: 0 0 8px 8px;
        }
        .footer-content { display: flex; justify-content: space-between; align-items: center; }
        .footer-text { flex: 1; font-size: 0.75rem; color: #6B7280; line-height: 1.4; }
        .footer-link { color: #F97316; text-decoration: none; }
        .footer-link:hover { text-decoration: underline; }
        .footer-logo { margin-left: 1.5rem; height: 60px; width: auto; }
        .actions { 
            display: flex; 
            gap: 1rem; 
            justify-content: center; 
            margin: 2rem 0; 
        }
        .btn { 
            padding: 0.75rem 1.5rem; 
            border-radius: 6px; 
            font-weight: 600; 
            font-size: 0.875rem; 
            text-decoration: none; 
            border: none; 
            cursor: pointer; 
            transition: all 0.2s ease; 
        }
        .btn-outline { 
            background: transparent; 
            color: #F97316; 
            border: 2px solid #F97316; 
        }
        .btn-outline:hover { 
            background: #F97316; 
            color: white; 
        }
        .btn-primary { 
            background: #F97316; 
            color: white; 
            border: 2px solid #F97316; 
        }
        .btn-primary:hover { 
            background: #EA580C; 
            border-color: #EA580C; 
        }
        .loading { 
            text-align: center; 
            padding: 2rem; 
            color: #6B7280; 
        }
        .error { 
            background: #FEF2F2; 
            border: 1px solid #FECACA; 
            color: #DC2626; 
            padding: 1rem; 
            border-radius: 6px; 
            text-align: center; 
        }
        @media (max-width: 768px) {
            .project-info { flex-direction: column; }
            .map-container { width: 100%; height: 250px; margin-top: 1rem; }
            .footer-content { flex-direction: column; text-align: center; }
            .footer-logo { margin: 1rem 0 0 0; }
            .actions { flex-direction: column; align-items: center; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Resumen del Boletín Ambiental de SSMAA</h1>
            <h2 id="fecha-boletin">Cargando...</h2>
        </div>
        
        <div class="content">
            <div id="loading" class="loading">
                <p>Cargando datos del boletín...</p>
            </div>
            
            <div id="error" class="error" style="display: none;">
                <p>Error al cargar los datos del boletín.</p>
            </div>
            
            <div id="content" style="display: none;">
                <!-- Contenido se cargará dinámicamente -->
            </div>
            
            <div class="actions">
                <button class="btn btn-outline" onclick="window.print()">Imprimir</button>
                <a href="/boletines-ssmaa" class="btn btn-primary">Volver al Dashboard</a>
            </div>
            
            <div class="footer">
                <div class="footer-content">
                    <div class="footer-text">
                        <p>La información presentada es obtenida de <a href="https://www.aguascalientes.gob.mx/SSMAA/BoletinesSMA/usuario_webexplorer.asp" target="_blank" class="footer-link">https://www.aguascalientes.gob.mx/SSMAA/BoletinesSMA/usuario_webexplorer.asp</a></p>
                        <p>La precisión de las ubicaciones y la calidad de la información son responsabilidad de la Secretaría de Sustentabilidad, Medio Ambiente y Agua.</p>
                        <p>ADN-A se limita a compartir información pública de interés para la sociedad.</p>
                    </div>
                    <img src="/assets/logocompleto.png" alt="Alianza por la Defensa de la Naturaleza Aguascalientes" class="footer-logo">
                </div>
            </div>
        </div>
    </div>

    <script>
        // Obtener el ID del boletín de la URL
        const urlParams = new URLSearchParams(window.location.search);
        const boletinId = urlParams.get('id') || '453'; // Default al 453
        
        // Función para formatear fechas
        function formatearFechaCorta(fecha) {
            const fechaObj = new Date(fecha);
            return fechaObj.toLocaleDateString('es-ES', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
        }
        
        // Función para calcular fecha límite
        function calcularFechaLimiteConsulta(fechaPublicacion) {
            const fecha = new Date(fechaPublicacion);
            let diasAgregados = 0;
            let diasHabiles = 0;
            
            while (diasHabiles < 10) {
                diasAgregados++;
                const fechaActual = new Date(fecha);
                fechaActual.setDate(fecha.getDate() + diasAgregados);
                
                if (fechaActual.getDay() !== 0 && fechaActual.getDay() !== 6) {
                    diasHabiles++;
                }
            }
            
            const fechaLimite = new Date(fecha);
            fechaLimite.setDate(fecha.getDate() + diasAgregados);
            
            return fechaLimite.toISOString().split('T')[0];
        }
        
        // Función para generar HTML del proyecto
        function generarHTMLProyecto(proyecto, esResolutivo = false) {
            const fechaLimite = esResolutivo ? '' : calcularFechaLimiteConsulta(proyecto.fecha_ingreso);
            const fechaLimiteFormateada = esResolutivo ? '' : formatearFechaCorta(fechaLimite);
            
            return `
                <div class="project-card">
                    <h3 class="project-title">${proyecto.nombre_proyecto}</h3>
                    <div class="project-info">
                        <div class="project-details">
                            <div class="info-item">
                                <span class="info-label">Promovente:</span>
                                <span class="info-value">${proyecto.promovente}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Municipio:</span>
                                <span class="info-value">${proyecto.municipio}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Expediente:</span>
                                <span class="info-value">${proyecto.expediente}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">${esResolutivo ? 'Fecha de ingreso:' : 'Fechas de ingreso:'}</span>
                                <span class="info-value">${formatearFechaCorta(proyecto.fecha_ingreso)}</span>
                            </div>
                            ${esResolutivo ? `
                                <div class="info-item">
                                    <span class="info-label">Fecha de resolutivo:</span>
                                    <span class="info-value">${formatearFechaCorta(proyecto.fecha_resolutivo)}</span>
                                </div>
                            ` : ''}
                            <div class="info-item">
                                <span class="info-label">Tipo:</span>
                                <span class="info-value">${proyecto.tipo_estudio}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Naturaleza del proyecto:</span>
                                <div class="naturaleza">${proyecto.naturaleza_proyecto}</div>
                            </div>
                        </div>
                        <div class="map-container">
                            ${proyecto.coordenadas_x && proyecto.coordenadas_y ? 
                                `<img src="https://staticmap.openstreetmap.de/staticmap.php?center=${proyecto.coordenadas_y},${proyecto.coordenadas_x}&zoom=15&size=400x300&markers=${proyecto.coordenadas_y},${proyecto.coordenadas_x},red" alt="Mapa de ubicación" class="map-image">` :
                                '<div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #f5f5f5; color: #6B7280;">Sin coordenadas</div>'
                            }
                            <div class="map-info">
                                Ubicación en ${proyecto.municipio}
                                ${proyecto.coordenadas_x && proyecto.coordenadas_y ? 
                                    `<br><a href="https://www.openstreetmap.org/?mlat=${proyecto.coordenadas_y}&mlon=${proyecto.coordenadas_x}&zoom=15" target="_blank" class="map-link">Ver en OpenStreetMap</a>` : ''
                                }
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Cargar datos del boletín
        async function cargarBoletin() {
            try {
                const response = await fetch('/data/boletines.json');
                const data = await response.json();
                
                const boletin = data.boletines.find(b => b.id == boletinId);
                
                if (!boletin) {
                    throw new Error('Boletín no encontrado');
                }
                
                // Actualizar título y fecha
                document.getElementById('fecha-boletin').textContent = formatearFechaCorta(boletin.fecha_publicacion);
                
                // Generar contenido
                let contenido = '';
                
                // Proyectos ingresados
                if (boletin.proyectos_ingresados && boletin.proyectos_ingresados.length > 0) {
                    const fechaLimite = calcularFechaLimiteConsulta(boletin.fecha_publicacion);
                    const fechaLimiteFormateada = formatearFechaCorta(fechaLimite);
                    
                    contenido += `
                        <h2 class="section-title">Proyectos ingresados a impacto ambiental</h2>
                        <div class="fecha-limite">
                            Fecha límite para solicitud de consulta pública: ${fechaLimiteFormateada}
                        </div>
                    `;
                    
                    boletin.proyectos_ingresados.forEach(proyecto => {
                        contenido += generarHTMLProyecto(proyecto, false);
                    });
                }
                
                // Resolutivos emitidos
                contenido += `
                    <h2 class="section-title" style="text-align: center;">
                        ${boletin.resolutivos_emitidos && boletin.resolutivos_emitidos.length > 0 ? 
                            `Resolutivos emitidos (${boletin.resolutivos_emitidos.length})` : 
                            'No se emitieron resolutivos'
                        }
                    </h2>
                `;
                
                if (boletin.resolutivos_emitidos && boletin.resolutivos_emitidos.length > 0) {
                    boletin.resolutivos_emitidos.forEach(resolutivo => {
                        contenido += generarHTMLProyecto(resolutivo, true);
                    });
                }
                
                // Mostrar contenido
                document.getElementById('content').innerHTML = contenido;
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
            }
        }
        
        // Cargar datos cuando se carga la página
        cargarBoletin();
    </script>
</body>
</html>